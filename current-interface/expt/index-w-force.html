<!DOCTYPE HTML>
<meta charset="utf-8">
<script src="js/jquery-3.2.1.min.js"></script>
<script type="text/javascript" src="js/d3.min.js"></script>
<style type="text/css">

.node--leaf circle {
   stroke-linecap: round;
   stroke-width: 0.5;
   stroke: white;
}

.links line {
  stroke: #aaa;
}

</style>

<body>
<script>

var w = 1280,
    h = 800,
    root,
    node,
    link,
    dataa,
    nodeData,
    link1Data,
    link2Data,
    forceNode;

var color = d3.scaleOrdinal(d3.schemeCategory20b);

var vis = d3.select("body").append("svg:svg")
    .attr("width", w)
    .attr("height", h)
      .append('g')
      .attr("transform", "translate(1,1)");

/*var stratify = d3.stratify()
   .id(function(d) { return d.id; })
   .parentId(function(d) { return d.group; });
*/
var pack = d3.pack()
   .size([w-2,h-2])
   .padding(3);

d3.json("testvalues.json", function(error, data) {
   if (error) console.log(error);

   dataa = data;
   nodeData = data.nodes;
   link1Data = data.link1s;
   link2Data = data.link2s;

   root = d3.hierarchy(nodeData)
      .count();

   pack(root);

   node = vis.selectAll("g")
      .data(root.descendants())
      .enter().append("g")
         .attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; })
         .attr("class", function(d) { return "node" + (d.children ? d.depth ? " node--internal" : " node--root" : " node--leaf"); })
         .each(function(d) { d.node = this; });
   // { return d.parent ? d.children ? "node" : "node node--leaf" : "node node--root"; }

   node.append("circle")
      .attr("id", function(d) { return "node-" + d.data.name; })
      .attr("r", function(d) { return d.r; })
      .style("fill", function(d) { if (d.data.name==="root") {return "none";} else {return color(d.data.truth);}});
         
   vis.selectAll(".node--internal").select("circle")
         .style("fill", "lightblue");

   node.append("title")
      .text(function(d) { return d.data.name; });
   
   forceNode = vis.selectAll(".node--leaf").select("circle");

   var simulation = d3.forceSimulation()
         .force("link", d3.forceLink().id(function(d) { return d.nodes.name; }))
         .force("charge", d3.forceManyBody())
         .force("center", d3.forceCenter(w/2, h/2));

   link = vis.append("g")
         .classed("links links1", "true");

   link.selectAll("line")
         .data(link1Data.links)
         .enter().append("line");

   simulation
      .nodes(forceNode._groups[0]);
      .on("tick", ticked);

   simulation.force("link")
     .links(link1Data.links);

   /*function ticked() {
      link
         .attr("x1", function(d) { return d.source.x; })
         .attr("y1", function(d) { return d.source.y; })
         .attr("x2", function(d) { return d.target.x; })
         .attr("y2", function(d) { return d.target.y; });
   }
   */
});
</script>
</body>
<!-- I tried to do the collapsible force layout, but this recipe calls for LINKS. so... I will move down to just do circle packing first. -->