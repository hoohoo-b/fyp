<!-- Switching between CSV data in tables -->

<!DOCTYPE html>
<html lang="en">
<head>
    <title>Bootstrap Example</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="js/bootstrap-filestyle.min.js"> </script>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <style>
        /* Remove the navbar's default margin-bottom and rounded borders */
        .navbar {
            margin-bottom: 0;
            border-radius: 0;
        }

        /* Set height of the grid so .sidenav can be 100% (adjust as needed) */
        .row.content {height: 600px}

        #progress{height: 60px}

        /* Set gray background color and 100% height */
        .sidenav {
            padding-top: 20px;
            background-color: #f1f1f1;
            height: 100%;
        }

        .text-inside-well{
            margin-top: -5px;
            padding-bottom:10px;
            font-size: 15px;
        }

        .text-inside-well2{
            margin-top: -12px;
            margin-left: -8px;
            padding-bottom:8px;
            font-size: 12px;
        }

        .text-inside-well3{
            margin-top: -12px;
            margin-left: -8px;
            padding-bottom:8px;
            font-size: 11.5px;
        }

        .Terminal-condition{
            margin-top: -12px;
            margin-bottom:-20px;
        }

        #Input-well{
            margin-top: -5px;
        }

        #Config-well{
            margin-top: -10px;
            margin-bottom: 0px;
        }

        #config-well2{
            margin-top: -10px;
        }

        #config-well3{
            margin-top: -10px;
            margin-bottom: 0px;
        }

        #start-button{
            margin-top: 8px;
        }

        #pause-button{
            margin-bottom: 8px;
        }

        .checkbox{
            font-size: 13px;
        }

        #bar{
            margin-top: 25px;
            margin-left: -12px;
            margin-right: -10px;
            height: 35px;
        }

        #text-in-bar{
            margin-top: 7px;
            font-size: 13px;
        }

        #form-choose-result{
            margin-top: -3px;
        }

        .graph-table{
            height: 100px;
            /*margin-left: -20px;*/
            overflow: scroll;
            margin-top: -10px;
        }

        /* Set black background color, white text and some padding */
        footer {
            background-color: #555;
            color: white;
            padding: 15px;
        }

        /* On small screens, set height to 'auto' for sidenav and grid */
        @media screen and (max-width: 767px) {
            .sidenav {
                height: auto;
                padding: 15px;
            }
            .row.content {height:auto;}
        }

        .uploadHidden {
            visibility: hidden;
            height: 5px;
        }
    </style>
</head>
<body>

<nav class="navbar navbar-inverse">
    <div class="container-fluid">
        <div class="navbar-header">
            <!-- <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button> -->
            <a class="navbar-brand" href="#">PERC Crowdsourcing Entity Resolution Platform</a>
        </div>
        <div class="collapse navbar-collapse" id="myNavbar">
            <!-- <ul class="nav navbar-nav">
              <li class="active"><a href="#">Home</a></li>
              <li><a href="#">About</a></li>
              <li><a href="#">Projects</a></li>
              <li><a href="#">Contact</a></li>
            </ul> -->
            <ul class="nav navbar-nav navbar-right">
                <li><a href="#"><span class="glyphicon glyphicon-log-in"></span> Login</a></li>
            </ul>
        </div>
    </div>
</nav>

<div class="container-fluid text-center">
    <div class="row content">


        <div class="col-sm-2 sidenav">

            <div class="well text-left" id="Input-well">
                <div class="text-inside-well">Input</div>
                <label for="fileUpload" class="btn btn-success btn-block">Target Dataset</label>
                <input id="fileUpload" class="uploadHidden" type="file">
                <label for="fileUpload2" class="btn btn-success btn-block">Initial Data(if any)</label>
                <input id="fileUpload2" class="uploadHidden" type="file">
                <label for="fileUpload3" class="btn btn-success btn-block">Gold Answer(if any)</label>
                <input id="fileUpload3" class="uploadHidden" type="file">
            </div>

            <div class="well text-left" id="Config-well">
                <div class="text-inside-well">Configuration</div>

                <div class="well text-left">
                    <div class="text-inside-well2">Batch Size:</div>
                    <select class="form-control" id="batch_size">
                        <option>1</option>
                        <option>2</option>
                        <option>3</option>
                        <option>4</option>
                    </select>
                </div>

                <div class="well text-left" id="config-well2">
                    <div class="text-inside-well2">Terminal Condition:</div>
                    <form class="Terminal-condition">
                        <div class="radio">
                            <label><input type="radio" name="optradio">Auto</label>
                        </div>
                        <div class="radio">
                            <label><input type="radio" name="optradio">Total loops:<input type="text" class="form-control" id="loops"></label>
                        </div>
                    </form>
                </div>

                <div class="well text-left" id="config-well3">
                    <div class="text-inside-well3">Clustering Algorithm:</div>
                    <select class="form-control" id="algo">
                        <option>SCC</option>
                        <option>Best</option>
                        <option>First</option>
                        <option>Pivot</option>
                    </select>
                </div>

            </div>

        </div>



        <div class="col-sm-7 text-center">
            <div class="row content" id="progress">

                <div class="col-sm-2 text-center">
                    <button type="button" class="btn btn-success btn-block" id="start-button">Start</button>
                    <button type="button" class="btn btn-success btn-block" id="pause-button">Pause</button>
                </div>

                <div class="col-sm-7 text-center">
                    <p id="answer-count" style="margin-top: 8px; margin-bottom: -16px"></p>
                    <div class="progress" id="bar">
                        <div class="progress-bar progress-bar-info" role="progressbar" id="progressbar" aria-valuenow="9"
                             aria-valuemin="0" aria-valuemax="100" style="width:9%">
                            <div id="text-in-bar">9%</div>
                        </div>
                    </div>
                </div>

                <div class="col-sm-3 text-left">
                    <form id="form-choose-result">
                        <div class="radio">
                            <label><input type="radio" id="forceOption" name="optradio" value="" checked>Uncertain Graph</label>
                        </div>
                        <div class="radio">
                            <label><input type="radio" id="clusterOption" name="optradio" value="">Clustering Result</label>
                        </div>
                        <div class="radio">
                            <label><input type="radio" id="nextQnOption" name="optradio" value="">Next Crowd Questions</label>
                        </div>
                        <div class="radio">
                            <label><input type="radio" id="packOption" name="optradio" value="">Circle Pack Layout</label>
                        </div>
                    </form>
                </div>
            </div>

            <style>

                .link2s line {
                    stroke: #f00;
                    stroke-opacity: 0.2;

                }

                .links line {
                    stroke: #999;
                    stroke-opacity: 0.6;

                }

                .fnodes circle {
                    stroke: #fff;
                    stroke-width: 1.5px;
                    fill-opacity: 1;
                }

                .node--root circle {
                    stroke: none;
                    fill: none;
                }
                .node--internal circle {
                    stroke:	#8b9dc3;
                    stroke-width: 0.7px;
                    fill: 	#e6f2ff;
                    stroke-linecap: round;
                }

                .node--leaf circle {
                    stroke: 	#c0c5ce;
                    stroke-width: 0.5px;
                    stroke-linecap: round;
                }

            </style>
            <svg id="svg" width="720" height="500" style="margin-left: -5px"></svg>
            <svg id="svg2" width="720" height="500" style="margin-left: -5px"></svg>

            <script>
                var w = +d3.select("svg").attr("width"),
                    h = +d3.select("svg").attr("height"),
                        root,
                        node;

                var radius = 5;
                var color = d3.scaleOrdinal(d3.schemeCategory20b);
                var svg2 = d3.select("#svg2");

                var vis = d3.select("svg")
                        .append('g')
                        .attr("transform", "translate(1,1)");

                var pack = d3.pack()
                        .size([w,h])
                        .padding(5);

                var simulation, link, link2, fnode;

                var fnodeg = svg2.append("g")
                    .attr("class", "fnodes");

                var linkg = svg2.append("g")
                    .attr("class", "links")
                    .attr("id", "linkg");

                var link2g = svg2.append("g")
                    .attr("class", "link2s")
                    .attr("id", "link2g");

                $(document).ready(function() {
                    $("#svg").hide();
                    $("#svg2").show();

                    $("#forceOption").click(function() {
                        $("#svg").hide();
                        $("#svg2").show();
                        $("#linkg").show();
                        $("#link2g").hide();
                    });

                    $("#clusterOption").click(function() {
                        $("#svg").hide();
                        $("#svg2").show();
                        $("#linkg").show();
                        $("#link2g").hide();
                    });

                    $("#nextQnOption").click(function() {
                        $("#svg").hide();
                        $("#svg2").show();
                        $("#linkg").hide();
                        $("#link2g").show();
                    });

                    $("#packOption").click(function() {
                        $("#svg").show();
                        $("#svg2").hide();
                    });
                });

                d3.json("vizData//circlePack//clustering_with_1800.json", function(error, data) {
                    if (error) throw error;
                    root = d3.hierarchy(data)
                            .sum(function (d) {
                                return d.size;
                            })
                            .sort(function (a, b) {
                                return b.height - a.height || b.size - a.size;
                            });

                    pack(root);

                    node = vis.selectAll(".node")
                            .data(root.descendants())
                            .enter().append("g")
                            .attr("transform", function (d) {
                                return "translate(" + d.x + "," + d.y + ")";
                            })
                            .attr("class", function (d) {
                                return "node" + (d.children ? d.depth ? " node--internal" : " node--root" : " node--leaf");
                            })
                            .each(function (d) {
                                d.node = this;
                            });

                    node.append("circle")
                            .attr("id", function (d) {
                                return 'c' + d.data.name;
                            })
                            .attr("r", function (d) {
                                return d.r;
                            })
                            .style("fill", function (d) {
                                if (d.data.name !== "root" && d.data.name.indexOf("group") === -1) return color(d.data.truth);
                            });

                    node.append("title")
                            .text(function (d) {
                                return d.children ? d.data.name : d.data.name + " " + d.data.truth;
                            }); // Do you have children? Yes/No


                    var leafNodes = vis.selectAll(".node--leaf");

                    leafNodes.on('mouseenter', mouseenter)
                            .on('mouseleave', mouseleave);

                    function mouseenter(d) {
                        d3.select(this.parentNode)
                                .append('image')
                                .attr('id', 'zoomImage')
                                .attr('xlink:href', 'AllSports\\' + d.data.name + '.JPG')
                                .attr("x", 0)
                                .attr("y", 0)
                                .attr('width', 200)
                                .attr('height', 200);
                    };

                    function mouseleave() {
                        d3.select('#zoomImage').remove();
                    };

                });

                d3.json("vizData//forceLayout//force_layout_with_1800.json", function(error, graph) {
                    if (error) throw error;

                    simulation = d3.forceSimulation()
                        .force("link", d3.forceLink().id(function (d) { return d.id; }).distance(30).strength(1))
                        .force("charge", d3.forceManyBody().strength(-2).distanceMin(15).distanceMax(180))
                        .force("center", d3.forceCenter(w / 2, h / 2))
                        .force("collide", d3.forceCollide().strength(1).iterations(2));


                    link = linkg.selectAll("line")
                            .data(graph.links)
                            .enter().append("line")
                            .attr("stroke-width", function (d) {
                                return Math.sqrt(Math.sqrt(Math.sqrt(d.value)));
                            });

                    link2 = link2g.selectAll("line")
                        .data(graph.link2s)
                        .enter().append("line")
                        .attr("stroke-width", function (d) {
                            return Math.sqrt(Math.sqrt(Math.sqrt(d.value)));
                        });

                    fnode = fnodeg.selectAll("circle")
                            .data(graph.nodes)
                            .enter().append("circle")
                            .attr("r", radius)
                            .attr("fill", function (d) {
                                return color(d.group);
                            });

                    simulation
                            .nodes(graph.nodes)
                            .on("tick", ticked);

                    simulation.force("link")
                            .links(graph.links);

                    fnode.append("title")
                        .text(function (d) {
                            return d.id;
                        });

                    fnode.on('mouseenter', mouseenter)
                            .on('mouseleave', mouseleave);

                    function mouseenter(d) {
                        d3.select(this.parentNode)
                                .append('image')
                                .attr('id', 'zoomImage')
                                .attr('xlink:href', 'AllSports\\' + d.id + '.JPG')
                                .attr("x", 0)
                                .attr("y", 0)
                                .attr('width', 200)
                                .attr('height', 200);
                    };

                    function mouseleave() {
                        d3.select('#zoomImage').remove();
                    };

                    var nodeArrayx = [];
                    var nodeArrayy = [];

                    function ticked() {
                        link
                            .attr("x1", function (d) {
                                return d.source.x;
                            })
                            .attr("y1", function (d) {
                                return d.source.y;
                            })
                            .attr("x2", function (d) {
                                return d.target.x;
                            })
                            .attr("y2", function (d) {
                                return d.target.y;
                            });

                        nodeArrayx = [];
                        nodeArrayy = [];

                        fnode
                            .attr("cx", function (d) {
                                return d.x = Math.max(radius, Math.min(w - radius, d.x));
                            })
                            .attr("cy", function (d) {
                                return d.y = Math.max(radius, Math.min(h - radius, d.y));
                            })
                            .each(function(d) {
                                nodeArrayx.push(Math.max(radius, Math.min(w - radius, d.x)));
                                nodeArrayy.push(Math.max(radius, Math.min(h - radius, d.y)));
                            });

                    }

                    d3.select("#forceOption")
                        .on("click", function() {
                            simulation
                                .force("link", d3.forceLink().id(function (d) { return d.id; }).distance(20).strength(1))
                                .force("charge", d3.forceManyBody().strength(-4).distanceMin(15).distanceMax(180))
                                .force("center", d3.forceCenter(w / 2, h / 2))
                                .force("collide", d3.forceCollide().strength(1).iterations(2));

                            simulation
                                .nodes(graph.nodes)
                                .on("tick", ticked);

                            simulation.force("link")
                                .links(graph.links);

                            simulation.alpha(0.05).restart();

                        });

                    d3.select("#clusterOption")
                        .on("click", function() {
                            simulation
                                .force("link", d3.forceLink().id(function (d) { return d.id; }).distance(10).strength(1))
                                .force("charge", d3.forceManyBody().strength(-4).distanceMin(15).distanceMax(180))
                                .force("center", d3.forceCenter(w / 2, h / 2))
                                .force("collide", d3.forceCollide().strength(1).iterations(2));

                            simulation
                                .nodes(graph.nodes)
                                .on("tick", ticked);

                            simulation.force("link")
                                .links(graph.links);

                            simulation.alpha(0.1).restart();

                        });

                    d3.select("#nextQnOption")
                        .on("click", function() {

                            simulation.stop();

                            simulation.force("link")
                                .links(graph.link2s);

                            link2
                                .attr("x1", function (d) {
                                    return Math.max(radius, Math.min(w - radius, d.source.x));
                                })
                                .attr("y1", function (d) {
                                    return Math.max(radius, Math.min(h - radius, d.source.y));
                                })
                                .attr("x2", function (d) {
                                    return Math.max(radius, Math.min(w - radius, d.target.x));
                                })
                                .attr("y2", function (d) {
                                    return Math.max(radius, Math.min(h - radius, d.target.y));
                                });
                        });
                });

            </script>
        </div>

        <div class="col-sm-3 sidenav text-left">

            <!-- this is the table of uncertain graph -->
            <h4 style="margin-top: -11px;margin-bottom:-3px; margin-left: -4px">Uncertain Graph</h4>
            <div class="container-fluid text-center" style="margin-left: -20px">
                <div class="text-center" >
                    <table class="table table-condensed" >
                        <thead>
                        <tr>
                            <th>Record 1</th>
                            <th>Record 2</th>
                            <th>Probability</th>
                        </tr>
                        </thead>
                        <div style="overflow: auto;">
                            <tbody></tbody>
                    </table>
                </div>
            </div>
            <div id="uncertain-graph" class="graph-table" style="margin-top: -22px">
                <div class="text-center" >

                    <script>
                        var graphTable = d3.select("#uncertain-graph")
                                .select("div")
                                .append("table")
                                .attr("class", "table table-condensed");

                        graphTable.append('thead');
                        graphTable.append('tbody');

                        d3.text("tableData//uncertain//uncertain_graph_1800.csv", function(error, data) {
                            if (error) throw error;

                            var parsedRows = d3.csvParseRows(data);

                            graphTable.select("tbody").selectAll("tr")
                                    .data(parsedRows)
                                    .enter().append("tr")

                                    .selectAll("td")
                                    .data(function(d) { return d; })
                                    .enter().append("td")
                                    .text(function(d) { return d; });
                        });
                    </script>
                </div>
            </div>
            <div class="text-right">
                <button type="button" class="btn btn-success" style="height: 28px;width: 75px;margin-top: 2px"><div style="margin-top: -3px;margin-left: -6px">Download</div></button>
            </div>


            <!-- this is the table of clustering result -->
            <h4 style="margin-top: 10px;margin-bottom:-3px; margin-left: -4px">Clustering</h4>
            <div class="container-fluid text-center" style="margin-left: -20px">
                <div class="text-center" >
                    <table class="table table-condensed" >
                        <thead>
                        <tr>
                            <th width="60%"><div style="margin-left: 30px">Cluster</div></th>
                            <th width="40%"><div style="margin-left: -6px">Records</div></th>
                        </tr>
                        </thead>
                        <div style="overflow: auto;">
                            <tbody></tbody>
                    </table>
                </div>
            </div>
            <div id="cluster-graph" class="graph-table" style="margin-top: -22px">
                <div class="text-center" >

                    <script>
                        var graphTable2 = d3.select("#cluster-graph").select("div")
                                .append("table")
                                .attr("class", "table table-condensed");

                        graphTable2.append("thead");
                        graphTable2.append("tbody");

                        d3.text("tableData//cluster//cluster_list_1800.tsv", function(error, data) {
                            if (error) throw error;

                            var parsedRows = d3.tsvParseRows(data);

                            graphTable2.select("tbody").selectAll("tr")
                                    .data(parsedRows)
                                    .enter().append("tr")

                                    .selectAll("td")
                                    .data(function(d) { return d; })
                                    .enter().append("td")
                                    .attr("width", function(d, i) { if (i%2===0) return "40%"; else return "60%"; })
                                    .text(function(d) { return d; });
                        });

                    </script>
                </div>

            </div>
            <div class="text-right">
                <button type="button" class="btn btn-success" style="height: 28px;width: 75px;margin-top: 2px"><div style="margin-top: -3px;margin-left: -6px">Download</div></button>
            </div>




            <!-- this is the table of NQ result -->
            <h4 style="margin-top: 10px;margin-bottom:-3px; margin-left: -4px">Next Questions</h4>
            <div class="container-fluid text-center" style="margin-left: -20px">
                <div class="text-center" >
                    <table class="table table-condensed" >
                        <thead>
                        <tr>
                            <th width="60%"><div style="margin-left: 30px">Record 1</div></th>
                            <th width="40%"><div style="margin-left: -6px">Record 2</div></th>
                        </tr>
                        </thead>
                        <div style="overflow: auto;">
                            <tbody></tbody>
                    </table>
                </div>
            </div>
            <div id="next-qn" class="graph-table" style="margin-top: -22px">
                <div class="text-center" >

                    <script>
                        var graphTable3 = d3.select("#next-qn").select("div")
                                .append("table")
                                .attr("class", "table table-condensed");

                        graphTable3.append("thead");
                        graphTable3.append("tbody");

                        d3.text("tableData//nextQn//next_qn_1800.csv", function(error, data) {
                            if (error) throw error;

                            var parsedRows = d3.csvParseRows(data);

                            graphTable3.select("tbody").selectAll("tr")
                                    .data(parsedRows)
                                    .enter().append("tr")

                                    .selectAll("td")
                                    .data(function(d) { return d; })
                                    .enter().append("td")
                                    .attr("width", function(d, i) { if (i%2===0) return "40%"; else return "60%"; })
                                    .text(function(d) { return d; })
                        });

                    </script>

                </div>
            </div>
            <div class="text-right">
                <button type="button" class="btn btn-success" style="height: 28px;width: 75px;margin-top: 2px"><div style="margin-top: -3px;margin-left: -6px">Download</div></button>
            </div>


        </div>
    </div>
</div>

<footer class="container-fluid text-center">
    <p>Copyright @ Nanyang Technologicial University</p>
</footer>

<script>
    var ansCount = document.getElementById('answer-count');
    var progressbar = document.getElementById('progressbar');
    var textInBar = document.getElementById('text-in-bar');

    var a = 1800;
    var p = (a/20000) * 100;
    ansCount.innerHTML = a;
    progressbar.setAttribute('aria-valuenow', p);
    progressbar.setAttribute('style', 'width: '+String(p)+'%');
    textInBar.innerHTML = String(p)+'%';

    d3.select('#start-button').on('click', function () {

        if (a < 20000) a += 200; else return;
        p = Math.round((a / 20000) * 100);
        ansCount.innerHTML = a;
        progressbar.setAttribute('aria-valuenow', p);
        progressbar.setAttribute('style', 'width: ' + String(p) + '%');
        textInBar.innerHTML = String(p) + '%';

        d3.json("vizData//circlePack//clustering_with_" + String(a) + ".json", function (error, data) {
            if (error) throw error;
            root = d3.hierarchy(data)
                .sum(function (d) {
                    return d.size;
                })
                .sort(function (a, b) {
                    return b.height - a.height || b.size - a.size;
                });
//         .count();

            pack(root);

            var t = d3.transition()
                .duration(500)
                .ease(d3.easeLinear);

            var t2 = d3.transition()
                .duration(100);

//                node.remove();

            node = vis.selectAll(".node")
                .data(root.descendants());
            //                        .enter().append("g")
            node.transition(t)
                .attr("transform", function (d) {
                    return "translate(" + d.x + "," + d.y + ")";
                })
                .attr("class", function (d) {
                    return "node" + (d.children ? d.depth ? " node--internal" : " node--root" : " node--leaf");
                })
                .each(function (d) {
                    d.node = this;
                });
            // { return d.parent ? d.children ? "node" : "node node--leaf" : "node node--root"; }

            node.select("circle")
                .attr("id", function (d) {
                    return 'c' + d.data.name;
                })
                .attr("r", function (d) {
                    return d.r;
                })
                .style("fill", function (d) {
                    if (d.data.name !== "root" && d.data.name.indexOf('group') === -1)  return color(d.data.truth);
                });

            var leafNodes = vis.selectAll(".node--leaf");

            leafNodes.on('mouseenter', mouseenter)
                .on('mouseleave', mouseleave);

            function mouseenter(d) {

                d3.select(this.parentNode)
                    .append('image')
                    .attr('id', 'zoomImage')
                    .attr('xlink:href', 'AllSports\\' + d.data.name + '.JPG')
                    .attr("x", 0)
                    .attr("y", 0)
                    .attr('width', 200)
                    .attr('height', 200);

// leafNodes.select('circle').interrupt().transition(t)
//            .attr("r", 30);
            }

            function mouseleave() {
                var zoomImage = d3.select('#zoomImage')
                    .remove();
            }

            node.select("title")
                .text(function (d) {
                    return d.children ? d.data.name : d.data.name + " " + d.data.truth;
                }); // Do you have children? Yes/No

            node.exit().transition(t2).style('opacity', 0).remove();

        });

        // TODO: Resolve if Python edited output is same as original... What's wrong?!

        d3.json("vizData//forceLayout//force_layout_with_" + String(a) + ".json", function (error, graph) {
            if (error) throw error;

            link = linkg.selectAll("line")
                .data(graph.links);

            link.enter().append("line")
                .attr("stroke-width", function (d) {
                    return Math.sqrt(Math.sqrt(Math.sqrt(d.value)));
                })
                .merge(link);

            link.exit().remove();

            link2 = link2g.selectAll("line")
                .data(graph.link2s);

            link2.enter().append("line")
                .attr("stroke-width", function (d) {
                    return Math.sqrt(Math.sqrt(Math.sqrt(d.value)));
                })
                .merge(link2);

            link2.exit().remove();

            fnode = fnodeg.selectAll("circle")
                .data(graph.nodes);

            fnode.enter().append("circle")
                .attr("r", radius)
                .attr("fill", function (d) {
                    return color(d.group);
                })
                .merge(fnode);

            fnode.exit().remove();

            simulation
                .nodes(graph.nodes)
                .on("tick", ticked);

            simulation.force("link")
                .links(graph.links);

            simulation.alpha(1).restart();

            fnode.append("title")
                .text(function (d) {
                    return d.id;
                });

            fnode.on('mouseenter', mouseenter)
                .on('mouseleave', mouseleave);

            function mouseenter(d) {
                d3.select(this.parentNode)
                    .append('image')
                    .attr('id', 'zoomImage')
                    .attr('xlink:href', 'AllSports\\' + d.id + '.JPG')
                    .attr("x", 0)
                    .attr("y", 0)
                    .attr('width', 200)
                    .attr('height', 200);
            }

            function mouseleave() {
                d3.select('#zoomImage').remove();
            }

            var nodeArrayx = [];
            var nodeArrayy = [];

            function ticked() {
                link
                    .attr("x1", function (d) {
                        return d.source.x;
                    })
                    .attr("y1", function (d) {
                        return d.source.y;
                    })
                    .attr("x2", function (d) {
                        return d.target.x;
                    })
                    .attr("y2", function (d) {
                        return d.target.y;
                    });

                nodeArrayx = [];
                nodeArrayy = [];

                fnode
                    .attr("cx", function (d) {
                        return d.x = Math.max(radius, Math.min(w - radius, d.x));
                    })
                    .attr("cy", function (d) {
                        return d.y = Math.max(radius, Math.min(h - radius, d.y));
                    })
                    .each(function (d) {
                        nodeArrayx.push(Math.max(radius, Math.min(w - radius, d.x)));
                        nodeArrayy.push(Math.max(radius, Math.min(h - radius, d.y)));
                    });

            }

            d3.select("#forceOption")
                .on("click", function () {
                    simulation
                        .force("link", d3.forceLink().id(function (d) {
                            return d.id;
                        }).distance(20).strength(1))
                        .force("charge", d3.forceManyBody().strength(-4).distanceMin(15).distanceMax(180))
                        .force("center", d3.forceCenter(w / 2, h / 2))
                        .force("collide", d3.forceCollide().strength(1).iterations(2));

                    simulation
                        .nodes(graph.nodes)
                        .on("tick", ticked);

                    simulation.force("link")
                        .links(graph.links);

                    simulation.alpha(0.05).restart();

                });

            d3.select("#clusterOption")
                .on("click", function () {
                    simulation
                        .force("link", d3.forceLink().id(function (d) {
                            return d.id;
                        }).distance(10).strength(1))
                        .force("charge", d3.forceManyBody().strength(-4).distanceMin(15).distanceMax(180))
                        .force("center", d3.forceCenter(w / 2, h / 2))
                        .force("collide", d3.forceCollide().strength(1).iterations(2));

                    simulation
                        .nodes(graph.nodes)
                        .on("tick", ticked);

                    simulation.force("link")
                        .links(graph.links);

                    simulation.alpha(0.1).restart();

                });

            d3.select("#nextQnOption")
                .on("click", function () {

                    simulation.stop();

                    simulation.force("link")
                        .links(graph.link2s);

                    link2
                        .attr("x1", function (d) {
                            return Math.max(radius, Math.min(w - radius, d.source.x));
                        })
                        .attr("y1", function (d) {
                            return Math.max(radius, Math.min(h - radius, d.source.y));
                        })
                        .attr("x2", function (d) {
                            return Math.max(radius, Math.min(w - radius, d.target.x));
                        })
                        .attr("y2", function (d) {
                            return Math.max(radius, Math.min(h - radius, d.target.y));
                        });
                });
        });

        // TODO: This data is obviously wrong...

            d3.text("tableData//uncertain//uncertain_graph_" + String(a) + ".csv", function (error, data) {
                if (error) throw error;

                var parsedRows = d3.csvParseRows(data);
                var gt = graphTable.select("tbody").selectAll("tr")
                    .data(parsedRows);

                gt.selectAll("td")
                    .data(function (d) {
                        return d;
                    })
                    .text(function (d) {
                        return d;
                    });

                gt.enter().append("tr")
                    .selectAll("td")
                    .data(function (d) {
                        return d;
                    })
                    .enter().append("td")
                    .text(function (d) {
                        return d;
                    });

                gt.selectAll("td")
                    .data(function (d) {
                        return d;
                    })
                    .exit().remove();

                gt.exit().remove();
            });

            d3.text("tableData//cluster//cluster_list_" + String(a) + ".tsv", function (error, data) {
                if (error) throw error;

                var parsedRows = d3.tsvParseRows(data);

                var gt2 = graphTable2.select("tbody").selectAll("tr")
                    .data(parsedRows);

                gt2.selectAll("td")
                    .data(function (d) {
                        return d;
                    })
                    .text(function (d) {
                        return d;
                    });

                gt2.enter().append("tr")
                    .selectAll("td")
                    .data(function (d) {
                        return d;
                    })
                    .enter().append("td")
                    .text(function (d) {
                        return d;
                    });

                gt2.selectAll("td").data(function (d) {
                    return d;
                })
                    .exit().remove();

                gt2.exit().remove();
            });


            d3.text("tableData//nextQn//next_qn_" + String(a) + ".csv", function (error, data) {
                if (error) throw error;

                var parsedRows = d3.csvParseRows(data);

                var gt3 = graphTable3.select("tbody").selectAll("tr")
                    .data(parsedRows);

                gt3.selectAll("td")
                    .data(function (d) {
                        return d;
                    })
                    .text(function (d) {
                        return d;
                    });

                gt3.enter().append("tr")
                    .selectAll("td")
                    .data(function (d) {
                        return d;
                    })
                    .enter().append("td")
                    .text(function (d) {
                        return d;
                    });

                gt3.selectAll("td").data(function (d) {
                    return d;
                })
                    .exit().remove();

                gt3.exit().remove();
            });
        });
</script>

</body>
</html>