<!DOCTYPE HTML>
<meta charset="utf-8">
<script type="text/javascript" src="https://d3js.org/d3.v4.min.js"></script>

<body>

<script>

var diameter = 500,
    format = d3.format(",d"),
    dataSource = 0,
    root,
    node;

var pack = d3.pack()
    .size([diameter - 4, diameter - 4]);
//    .value(function(d) { return d.size; });

var svg = d3.select("body").append("svg")
    .attr("width", diameter)
    .attr("height", diameter);

var vis = svg.append("g");

var buttonData = ["Original", "Constant", "Random"];
var buttonDiv = d3.select("body").append("svg")
    .attr("width", diameter)
    .attr("height", 50);

d3.json("flare.json", function(error, data) {
    
  if (error) throw error;
    var buttons = buttonDiv.selectAll(".updateButton") // class: updateButton
        .data(buttonData)
       .enter()
        .append('g')
        .attr("class", "updateButton")
        .on("click", function(d, i) {
            dataSource = i;
            updateVis();        
        });

    buttons.append("rect")
        .attr("x", function(d, i) { return (i * 100) + 100; })
        .attr("width", 98)
        .attr("height", 25)
        .attr("ry", 5)
        .style("stroke", "#787878")
        .style("fill", "tan");

    buttons.append("text")
        .attr("x", function(d, i) { return (i * 100) + (100 / 2) + 98; }) 
        .attr("y", 12)
        .attr("dy", "0.35em")
        .style("text-anchor", "middle")
        .style("font-size", "15px")
        .text(function(d) { return d; });

    root = d3.hierarchy(data)
            //.count();
            .sum(function(d) { return d.size; });
            //.sort(function(a, b) { return b.height - a.height || b.size - a.size; });

    pack(root);

    node = vis.selectAll("g")
        .data(root.descendants())
        .enter()
        .append("g")
        .each(function(d) { d.node = this; });

    var titles = node.append("title")
        .attr("x", function(d) { return d.x; })
        .attr("y", function(d) { return d.y; })
        .text(function(d) { return d.data.name +
            (d.children ? "" : ": " + format(d.value)); });

    var circles = node.append("circle")
        .attr("stroke", "black")
        .style("fill", function(d) { return d.children ? "beige" : "tan"; })
        .attr("cx", function(d) { return d.x; })
        .attr("cy", function(d) { return d.y; })
        .attr("r", function(d) { return d.r; });

    updateVis();

function updateVis() {

    if (dataSource == 0) {
        console.log("log");
        root = d3.hierarchy(data)
            // .count();
            .sum(function(d) { return d.size ? d.size : 0; })
            .sort(function(a, b) { return b.height - a.height || b.value - a.value; });
    }
    if (dataSource == 1) {
        console.log("log");
        root = d3.hierarchy(data)
            .sum(function(d) { return 100; })
            .sort(function(a, b) { return 0; });
    }

    if (dataSource == 2) {
        console.log("log");
        root = d3.hierarchy(data)
            .sum(function(d) { return Math.ceil(Math.random()*300); });
    }

        pack(root);

    titles.attr("x", function(d) { return d.x; })
        .attr("y", function(d) { return d.y; })
        .text(function(d) { return d.data.name +
            (d.children ? "" : ": " + format(d.value)); });

    circles.transition()
        .duration(5000)
        .attr("cx", function(d) { return d.x; })
        .attr("cy", function(d) { return d.y; })
        .attr("r", function(d) { return d.r; });
};

});
</script>
</body>
